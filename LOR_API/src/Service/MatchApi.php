<?php

namespace App\Service;

use App\Document\Criterias;
use Doctrine\ODM\MongoDB\DocumentManager;
use Symfony\Component\HttpFoundation\Response;

class MatchApi
{ 
    public function getMatchApi($test, $dm)
    {
        $arraySumonnerName = [ 'azerty', 'Phyrro', 'Myrendir', 'Cynath17', 'Druxys', 'Asymptomatik', 'Nikoflk', 'RunerodBaguette', 'Bananiolette', 'Alphinax', 'Batounu', 'Colonel popi', 'Dr Ratch', 'Doraiiden'];

        $arrayMatch = ['4866340622', '4888493060', '4888493061', '4790926826', '4790959924', '4894708501', '4885984852', '4838942318', '4249635365', '4838863780', '4837185496', '4831508522', '4749548464', '4831464026', '4829398297', '4829336350', '4826968268', '4826964026', '4824949721', '4819921738', '4807801330', 
         '4807688093', '4307978130', '4303489816', '4303286992', '4247207806', '4246258043', '4246252519', '4246166263', '4246111817', '4241549437', '4241154879', '4241069153', '4239618628', '4238512525', '4237999118', '4237618342', '4235903430', '4235759359', '4235744794', '4235719655', '4234156393', '4234211860',
         '4234069230', '4213525454', '4213484985', '4213502508', '4205676193', '4205673835', '4205619916', '4204344911', '4175647850', '4169692392', '4169649066', '4169635786', '4169642112', '4169587178', '4169602847', '4169546763', '4162932252', '4162886153', '4151979642', '4151992249', '4150442529', '4148988930',
         '4149002083', '4147780977', '4147721235', '4147630123', '4147621694', '4147579201', '4143050184', '4001848507', '4001845188', '4001831456', '4001787054', '4001811923' ,'4001690321' ,'3997972164', '3997918998', '3997899814', '3991431702', '3990226147', '4770462412' ,'4768579397', '4768559551', '4768551816', 
         '4767173060', '4767007458', '4767101158', '4758671288', '4758415627', '4758230095', '4743403577', '4743217879', '4741846608', '4741880930', '4739930368', '4731807717', '4730867534', '4730851140', '4730653353', '4730588128', '4770462510', '4770463455', '5193943354' ,'5197082813' ,'5197649336', '5197749256', 
         '5197744852', '5197675511', '5197691613', '5195689168', '4779944150', '5196959311', '5196986517', '5193759229', '5194006114', '5192932960', '5452194661', '5372103359', '5205144955', '5208444295', '5452087101', '5208601815', '5208508730', '5208495940', '5208319458', '5208258116', '5208227642', '5208253876', 
         '5207665624', '5207582417', '5207457553', '5207472779', '5207358488', '5207314368', '5207239526', '5207109715', '5207134536', '5206535496', '5206483586' ,'5205141944', '5204722463', '5204647796', '5204090919', '5203959959', '5200359030', '5200337685' ,'5200325075' ,'5200372415', '5196902868' ,'5196730256',
         '5195674459', '5195611850', '5194111272', '5192978077', '5192707100', '5192704414', '5192730678', '5174327971', '5174193140', '5174088532', '5174094333' ,'5174081015', '5173937253', '5173990621', '5173875208', '5170898464', '5170846125', '5170920619', '5170807021' ,'5170616223', '5170661329', '5112603454',
         '5112509227', '5048200525', '5007371119', '5007204088', '4960208425', '4960256717', '4960214854', '4949782171', '4949710297', '4949696896', '4946296766' ,'4946283734', '4946300876', '4946119098', '4946160851', '4946017414', '4946103472', '4946021259', '4925601331', '4920749472', '4920797180', '4920805139', 
         '4894897006', '4894873688', '4894870525', '4894281557', '4892803711', '4889485919', '4889443712', '4880337129', '5457780957', '5457524642', '5457541632' ,'5457376416', '5457372862', '5456984751', '5456920431', '5455595770', '5455571714', '5455536366', '5455524548', '5277124187', '5277008663', '5275390504', 
         '5275324316', '5274872099', '5274861230', '5273395936', '5269221424', '5269128527', '5269066349', '5269124206', '5268102297', '5119440567', '5041349642', '5041401146', '4949285802', '4947587305', '4944803882', '4904348344', '4904225978', '4904270622', '4903965591' ,'4730565374', '4729523260' ,'4729215095', 
         '4729168966', '4729115449', '4729076275', '4729013579', '4728977879', '4728701819', '4728567895', '4728583750', '4728505354', '4728400873', '4728122333', '4727874420', '4727210575', '4727114579', '4723585980', '4723522116', '4723416922', '4723192862', '4723100165', '4723145894', '4723152380' ,'4723077516',
         '4722980409', '4722941746', '4722876240', '4722500257', '4722554965', '4722466426', '4722369620', '4721723381', '4721567641', '4721620741', '4721485330', '4721480910', '4721077247', '4721052919', '4720986164', '4720899287', '4720860864', '4711037478', '4711055498' ,'4629443107'];
         for ($i = 0; $i < (count($arrayMatch)); $i++) {
            $url = file_get_contents("http://51.255.160.47:8181/euw1/passerelle/getHistoryMatch/" . $arrayMatch[$i]);
            $json = json_decode($url, true);
            for ($v = 0; $v < count($arraySumonnerName); $v++) {
                
                for ($p = 0; $p < count($json['participants']); $p++) {
                    if ($json['participantIdentities'][$p]['player']["summonerName"] === $arraySumonnerName[$v]) {
                       
                        $gameId = $json["gameId"];
                        
                            if (array_key_exists("kills", $json['participants'][$p]['stats'])) {
                                $kills = $json['participants'][$p]['stats']["kills"];
                            }

                            if (array_key_exists("deaths", $json['participants'][$p]['stats'])) {
                                $deaths = $json['participants'][$p]['stats']["deaths"];
                            }
        
                            if (array_key_exists("assists", $json['participants'][$p]['stats'])) {
                                $assists = $json['participants'][$p]['stats']["assists"];
                            }

                            if (array_key_exists("summonerName", $json['participantIdentities'][$p]['player'])) {
                                $pseudo = $json['participantIdentities'][$p]['player']["summonerName"];
                            }

                                $repository = $dm->getRepository(Criterias::class);
                                $array = $repository->findBy(['gameId' => $gameId]);
                
                                    if ($array) {
                                        // $array->setGameId($gameId);
                                        // $array->setPseudo($pseudo);
                                        // $array->setKill($kill);
                                        // $array->setDeath($death);
                                        // $array->setAssist($assist);
                                        // $array->setSeason($season);
                                        // $array->setTimeStamp($timeStamp);
                
                                        // $dm->persist($array);
                                    } else {
                                        $array = new Criterias();
                
                                        $array->setGameId($gameId);
                                        $array->setPseudo($pseudo);
                                        $array->setKill($kills);
                                        $array->setDeath($deaths);
                                        $array->setAssist($assists);
                                        $dm->persist($array);
                                    }
                    }
                }
            } 
          $dm->flush();
        }  
       
    }
}